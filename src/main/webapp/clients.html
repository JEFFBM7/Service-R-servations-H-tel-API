<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clients - Service Hôtel</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="header">
        <h1>Clients</h1>
        <nav class="nav">
            <a href="index.html">Accueil</a>
            <a href="reservations.html">Réservations</a>
            <a href="disponibilite.html">Disponibilité</a>
            <a href="clients.html" class="active">Clients</a>
            <a href="rapport.html">Rapport</a>
        </nav>
    </header>
    <div class="container">
        <div class="info-box">Consultez les informations client via le <strong>Service Gestion des Clients</strong> et associez un client à une réservation.</div>
        <div id="message" class="message"></div>
        <div class="card">
            <div class="card-title">Rechercher un client</div>
            <form id="searchForm" class="search-row">
                <div class="form-group"><input type="number" id="clientId" min="1" placeholder="ID Client"></div>
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </form>
            <div id="clientResult"></div>
        </div>
        <div class="card" id="reservationsSection" style="display: none;">
            <div class="card-title">Réservations du client</div>
            <div id="reservationsClient"></div>
        </div>
        <div class="card" id="newReservationSection" style="display: none;">
            <div class="card-title">Nouvelle réservation pour ce client</div>
            <form id="newReservationForm">
                <input type="hidden" id="selectedClientId">
                <div class="form-grid">
                    <div class="form-group"><label>ID Chambre</label><input type="number" id="chambreId" required min="1" placeholder="101"></div>
                    <div class="form-group"><label>Date d'arrivée</label><input type="date" id="dateDebut" required></div>
                    <div class="form-group"><label>Date de départ</label><input type="date" id="dateFin" required></div>
                    <div class="form-group"><label>Remarques</label><input type="text" id="remarques" placeholder="Optionnel"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top: 16px;">Créer la réservation</button>
            </form>
        </div>
        <div class="card">
            <div class="card-title">Clients enregistrés</div>
            <div class="clients-grid">
                <div class="client-mini" onclick="selectClient(1)"><h4>Jean Dupont</h4><p>jean.dupont@email.com</p></div>
                <div class="client-mini" onclick="selectClient(2)"><h4>Marie Martin</h4><p>marie.martin@email.com</p></div>
                <div class="client-mini" onclick="selectClient(3)"><h4>Pierre Bernard</h4><p>pierre.bernard@email.com</p></div>
                <div class="client-mini" onclick="selectClient(4)"><h4>Sophie Leroy</h4><p>sophie.leroy@email.com</p></div>
            </div>
        </div>
    </div>
    <script>
        const API_BASE = 'api/reservations';
        const clients = { 1: { id: 1, nom: 'Jean Dupont', email: 'jean.dupont@email.com', tel: '+33 6 12 34 56 78', vip: false }, 2: { id: 2, nom: 'Marie Martin', email: 'marie.martin@email.com', tel: '+33 6 98 76 54 32', vip: true }, 3: { id: 3, nom: 'Pierre Bernard', email: 'pierre.bernard@email.com', tel: '+33 6 55 44 33 22', vip: false }, 4: { id: 4, nom: 'Sophie Leroy', email: 'sophie.leroy@email.com', tel: '+33 6 11 22 33 44', vip: false } };
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateDebut').min = today;
            document.getElementById('dateFin').min = today;
            document.getElementById('searchForm').addEventListener('submit', function(e) { e.preventDefault(); rechercherClient(); });
            document.getElementById('newReservationForm').addEventListener('submit', function(e) { e.preventDefault(); creerReservation(); });
        });
        function selectClient(id) { document.getElementById('clientId').value = id; rechercherClient(); }
        function afficherMessage(texte, type) { const msg = document.getElementById('message'); msg.textContent = texte; msg.className = 'message ' + type; msg.style.display = 'block'; setTimeout(() => msg.style.display = 'none', 4000); }
        function rechercherClient() {
            const id = document.getElementById('clientId').value; if (!id) return;
            const client = clients[id] || { id, nom: 'Client ' + id, email: 'client' + id + '@hotel.com', tel: '—', vip: false };
            document.getElementById('clientResult').innerHTML = `<div class="client-card"><div class="avatar"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><div class="client-info"><h3>${client.nom}</h3><p>${client.email}</p><p>${client.tel}</p><span class="client-badge ${client.vip ? 'vip' : 'valid'}">${client.vip ? 'VIP' : 'Actif'}</span></div></div>`;
            chargerReservationsClient(id);
            document.getElementById('selectedClientId').value = id;
            document.getElementById('newReservationSection').style.display = 'block';
        }
        async function chargerReservationsClient(clientId) {
            const section = document.getElementById('reservationsSection');
            const container = document.getElementById('reservationsClient');
            try {
                const response = await fetch(`${API_BASE}?clientId=${clientId}`);
                const data = await response.json();
                section.style.display = 'block';
                if (data.length === 0) { container.innerHTML = '<p style="color: #888; font-size: 14px;">Aucune réservation</p>'; }
                else { container.innerHTML = `<table><thead><tr><th>ID</th><th>Chambre</th><th>Dates</th><th>Statut</th></tr></thead><tbody>${data.map(r => `<tr><td>#${r.id}</td><td>${r.numeroChambre || r.chambreId}</td><td>${r.dateDebut} → ${r.dateFin}</td><td><span class="badge badge-${r.statut === 'EN_ATTENTE' ? 'pending' : r.statut === 'CONFIRMEE' ? 'confirmed' : r.statut === 'EN_COURS' ? 'active' : r.statut === 'ANNULEE' ? 'cancelled' : 'completed'}">${r.statut}</span></td></tr>`).join('')}</tbody></table>`; }
            } catch (e) { container.innerHTML = '<p style="color: #888;">Erreur de chargement</p>'; }
        }
        async function creerReservation() {
            const clientId = document.getElementById('selectedClientId').value;
            const data = { clientId: parseInt(clientId), chambreId: parseInt(document.getElementById('chambreId').value), dateDebut: document.getElementById('dateDebut').value, dateFin: document.getElementById('dateFin').value, remarques: document.getElementById('remarques').value };
            try {
                const response = await fetch(API_BASE, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                if (response.ok) { afficherMessage('Réservation créée', 'success'); document.getElementById('newReservationForm').reset(); document.getElementById('selectedClientId').value = clientId; chargerReservationsClient(clientId); }
                else { const err = await response.json(); afficherMessage(err.message, 'error'); }
            } catch (e) { afficherMessage('Erreur', 'error'); }
        }
    </script>
</body>
</html>
